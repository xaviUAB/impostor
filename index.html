<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joc de l'Impostor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* Blau molt fosc gairebé negre */
            color: #f8fafc;
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-primary {
            background: #ef4444;
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.3);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-primary:active {
            transform: scale(0.96);
            background: #dc2626;
        }

        .control-btn {
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.1s ease;
        }

        .control-btn:active {
            background: #334155;
            transform: scale(0.9);
        }

        .impostor-glow {
            text-shadow: 0 0 30px rgba(239, 68, 68, 0.4);
        }

        .character-img {
            filter: drop-shadow(0 20px 30px rgba(0, 0, 0, 0.5));
            max-height: 200px;
        }

        /* Animació de pols per al botó de transició */
        @keyframes soft-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.1); }
            70% { box-shadow: 0 0 0 30px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .pulse-effect {
            animation: soft-pulse 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center overflow-hidden bg-slate-950">

    <!-- PANTALLA DE CONFIGURACIÓ -->
    <!-- Ajustada a items-start i reduït el padding per pujar-ho tot -->
    <div id="setup-screen" class="flex flex-col items-center justify-start h-screen w-full pt-6 pb-16 px-8 max-w-md mx-auto space-y-6">
        
        <!-- Part Superior: Marca i Inici -->
        <div class="w-full flex flex-col items-center space-y-5">
            <div class="relative">
                <img id="main-logo" 
                     src="https://raw.githubusercontent.com/xaviUAB/impostor/main/imatges/titol_impostor.png" 
                     alt="IMPOSTOR" 
                     class="w-full max-w-[160px] h-auto drop-shadow-2xl"
                     onload="this.classList.remove('hidden'); document.getElementById('fallback-title').classList.add('hidden');"
                     onerror="this.classList.add('hidden'); document.getElementById('fallback-title').classList.remove('hidden');">
                
                <div id="fallback-title" class="hidden text-center">
                    <h1 class="text-3xl font-black tracking-tighter italic text-red-500 uppercase impostor-glow">IMPOSTOR</h1>
                </div>
            </div>

            <!-- Botó "Repartir Rols" una mica més petit -->
            <button onclick="startGame()" class="btn-primary w-full py-4 rounded-2xl font-black text-lg uppercase tracking-wider">
                REPARTIR ROLS
            </button>
        </div>

        <!-- Part Central-Inferior: Controls de joc compactats -->
        <div class="w-full space-y-5">
            <!-- Selector Jugadors -->
            <div class="space-y-2">
                <label class="block text-center text-[9px] font-bold text-slate-500 uppercase tracking-[0.2em]">Número de jugadors</label>
                <div class="flex items-center justify-between glass-panel rounded-2xl p-1.5">
                    <button onclick="adjustValue('total-players', -1)" class="control-btn w-12 h-12 flex items-center justify-center rounded-xl text-xl font-light">－</button>
                    <span id="display-total-players" class="text-2xl font-bold w-14 text-center text-slate-200">4</span>
                    <button onclick="adjustValue('total-players', 1)" class="control-btn w-12 h-12 flex items-center justify-center rounded-xl text-xl font-light">＋</button>
                </div>
            </div>

            <!-- Selector Impostors -->
            <div class="space-y-2">
                <label class="block text-center text-[9px] font-bold text-slate-500 uppercase tracking-[0.2em]">Número d'impostors</label>
                <div class="flex items-center justify-between glass-panel rounded-2xl p-1.5">
                    <button onclick="adjustValue('total-impostors', -1)" class="control-btn w-12 h-12 flex items-center justify-center rounded-xl text-xl font-light">－</button>
                    <span id="display-total-impostors" class="text-2xl font-bold w-14 text-center text-slate-200">1</span>
                    <button onclick="adjustValue('total-impostors', 1)" class="control-btn w-12 h-12 flex items-center justify-center rounded-xl text-xl font-light">＋</button>
                </div>
                
                <!-- Toggle Mode Aleatori -->
                <div class="flex items-center justify-center pt-1">
                    <label class="flex items-center cursor-pointer p-2">
                        <div class="relative">
                            <input type="checkbox" id="random-mode" class="sr-only peer">
                            <div class="w-10 h-5 bg-slate-800 rounded-full peer peer-checked:bg-red-500/80 transition-all duration-300"></div>
                            <div class="absolute left-1 top-1 bg-white w-3 h-3 rounded-full transition-all duration-300 peer-checked:translate-x-5"></div>
                        </div>
                        <span class="ml-3 text-slate-500 font-semibold uppercase text-[8px] tracking-widest">Mode Aleatori</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA DE TRANSICIÓ (PASSAR MÒBIL) -->
    <div id="transition-screen" class="hidden full-screen-btn bg-slate-950 pb-20">
        <div class="text-center p-8 w-full h-full flex flex-col justify-center items-center space-y-12">
            <div>
                <h2 id="player-turn-text" class="text-5xl font-black uppercase italic text-red-500 mb-2 impostor-glow">Jugador 1</h2>
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-[0.3em]">És el teu torn</p>
            </div>
            
            <div class="w-60 h-60 glass-panel rounded-full flex items-center justify-center pulse-effect active:scale-95 transition-transform duration-200 cursor-pointer" onclick="revealRole()">
                <span class="text-slate-300 font-black text-xs text-center px-10 uppercase leading-relaxed tracking-widest">Clica per revelar el teu rol</span>
            </div>
            
            <p class="text-slate-600 text-[10px] italic">Assegura't que ningú més mira</p>
        </div>
    </div>

    <!-- PANTALLA DE REVELACIÓ -->
    <div id="reveal-screen" class="hidden flex flex-col items-center justify-between h-screen w-full pt-10 pb-20 px-8 text-center bg-slate-950">
        <div class="flex-1 flex flex-col items-center justify-center w-full">
            <div id="role-display" class="w-full flex flex-col items-center">
                <!-- Contingut generat per JS -->
            </div>
        </div>

        <button onclick="nextTurn()" class="w-full max-w-xs py-5 glass-panel rounded-2xl font-bold text-base uppercase tracking-widest text-slate-400 active:bg-slate-800 transition-colors">
            Ocultar Assignació
        </button>
    </div>

    <!-- PANTALLA FINAL -->
    <div id="end-screen" class="hidden flex flex-col items-center justify-between h-screen w-full pt-10 pb-20 px-8 text-center bg-slate-950">
        <div class="flex-1 flex flex-col items-center justify-center space-y-8 w-full">
            <div class="space-y-2">
                <h2 class="text-3xl font-black text-emerald-500 uppercase italic tracking-tight">ROLS ASSIGNATS</h2>
                <p class="text-slate-500 text-xs">Tots els jugadors coneixen la seva identitat.</p>
            </div>

            <div class="p-6 glass-panel rounded-3xl w-full border-emerald-500/20">
                <p class="text-[8px] text-slate-500 uppercase font-black mb-3 tracking-[0.2em]">Detalls de la partida</p>
                <div id="game-summary" class="text-xl font-bold text-slate-200 mb-1"></div>
                <div id="game-mode-info" class="text-[9px] text-slate-500 italic"></div>
            </div>
            
            <p class="text-slate-400 text-xs italic">Comenceu el debat!</p>
        </div>
        
        <button onclick="resetGame()" class="w-full py-5 bg-slate-800 rounded-2xl font-bold uppercase tracking-widest text-slate-300 active:bg-slate-700 transition-colors">
            Nova Partida
        </button>
    </div>

    <script>
        // Dades de paraules categoritzades
        const wordCategories = {
            "Oficis": ["Advocat", "Arquitecte", "Astronauta", "Barber", "Bomber", "Cambrer", "Carnisser", "Científic", "Cuiner", "Dentista", "Escriptor", "Electricista", "Enfermer", "Fuster", "Fotògraf", "Informàtic", "Jutge", "Mecànic", "Metge", "Músic", "Pintor", "Pilot", "Policia", "Professor", "Psicòleg", "Veterinari", "Venedor", "Pagès", "Actor", "Ballarí"],
            "Llar": ["Cadira", "Taula", "Sofà", "Llit", "Armari", "Mirall", "Llampa", "Catifa", "Cortina", "Rellotge", "Nevera", "Forn", "Microones", "Rentadora", "Rentaplats", "Televisor", "Ordinador", "Telèfon", "Ràdio", "Clau", "Martell", "Tornavís", "Alicates", "Escala", "Recollidor", "Escombra", "Pala", "Ventilador", "Paraigua", "Maleta"],
            "Roba": ["Samarreta", "Pantalons", "Jaqueta", "Abric", "Faldilla", "Vestit", "Jersei", "Mitjons", "Sabates", "Botes", "Sandàlies", "Gorra", "Barret", "Bufanda", "Guants", "Cinturó", "Corbata", "Pijama", "Barnús", "Roba interior", "Ulleres", "Rellotge de polsera", "Bossa", "Motxilla", "Moneder", "Collaret", "Anell", "Arracades", "Polsera"],
            "Animals": ["Gos", "Gat", "Cavall", "Vaca", "Porc", "Ovella", "Cabra", "Gallina", "Gall", "Ànec", "Elefant", "Lleó", "Tigre", "Girafa", "Zebra", "Mico", "Os", "Llop", "Guineu", "Conill", "Ratolí", "Serp", "Cocodril", "Tortuga", "Rana", "Peix", "Tauró", "Dofí", "Balena", "Pingüí", "Àguila", "Mussol", "Lloro", "Abella", "Papallona", "Aranya"],
            "Menjar": ["Poma", "Plàtan", "Taronja", "Maduixa", "Raïm", "Pera", "Llimona", "Síndria", "Meló", "Pinya", "Kiwi", "Cirera", "Préssec", "Enciam", "Tomàquet", "Pastanaga", "Patata", "Ceba", "All", "Pebrot", "Bròquil", "Pa", "Arròs", "Pasta", "Pizza", "Hamburguesa", "Formatge", "Ou", "Llet", "Iogurt", "Xocolata", "Gelat", "Cafè", "Té", "Vi", "Cervesa"],
            "Transport": ["Cotxe", "Autobús", "Tren", "Metro", "Tramvia", "Bicicleta", "Moto", "Avió", "Helicòpter", "Vaixell", "Submarí", "Coet", "Tractor", "Camió", "Taxi", "Ambulància", "Grúa", "Caravana", "Veler", "Canoa"],
            "Llocs": ["Escola", "Universitat", "Hospital", "Església", "Museu", "Teatre", "Cine", "Biblioteca", "Restaurant", "Hotel", "Supermercat", "Mercat", "Parc", "Platja", "Muntanya", "Bosc", "Riu", "Llac", "Mar", "Illa", "Desert", "Castell", "Pont", "Aeroport", "Estació", "Gimnàs", "Piscina", "Estadi", "Banc", "Oficina", "Selva"],
            "Espai i Clima": ["Sol", "Lluna", "Estrella", "Planeta", "Terra", "Mart", "Núvol", "Pluja", "Neu", "Vent", "Tempesta", "Llampec", "Arc de Sant Martí", "Foc", "Aigua", "Aire", "Gel"],
            "Esports": ["Futbol", "Bàsquet", "Tennis", "Natació", "Ciclisme", "Escacs", "Boxa", "Karate", "Esquí", "Golf"],
            "Instruments": ["Guitarra", "Piano", "Violí", "Trompeta", "Tambor", "Flauta", "Saxofon", "Arpa", "Clarinet", "Acordió"],
            "Anatomia": ["Cap", "Braç", "Cama", "Cor", "Estómac", "Pulmó", "Orella", "Nas", "Ull", "Mà"],
            "Cuina": ["Cullera", "Forquilla", "Ganivet", "Paella", "Olla", "Cassola", "Espàtula", "Ratllador", "Batedora", "Colador"],
            "Tecnologia": ["Tablet", "Monitor", "Teclat", "Ratolí", "Impressora", "Càmera", "Altaveu", "Auriculars", "Dron", "Consola"],
            "Esdeveniments": ["Casament", "Aniversari", "Concert", "Festa", "Carnaval", "Festival", "Bateig", "Sopar", "Viatge", "Excursió"],
            "Geometria": ["Cercle", "Quadrat", "Triangle", "Rectangle", "Cub", "Esfera", "Cilindre", "Piràmide", "Rombe", "Oval"],
            "Construccions": ["Gratacels", "Cabana", "Far", "Monestir", "Molí", "Granja", "Garatge", "Hangar", "Búnquer", "Fàbrica"],
            "Materials": ["Fusta", "Metall", "Vidre", "Plàstic", "Paper", "Cartró", "Pedra", "Or", "Plata", "Coure"],
            "Bany": ["Sabó", "Tovallola", "Raspall", "Esponja", "Xampú", "Pinta", "Dutxa", "Banyera", "Secador", "Vàter"],
            "Pel·lícules": ["Toy Story", "Jurassic Park", "Titanic", "Star Wars", "El Rei Lleó", "Matrix", "Harry Potter", "Gladiator", "Shrek", "Avatar"],
            "Sèries": ["Friends", "Game of Thrones", "Stranger Things", "The Simpsons", "Breaking Bad", "Lost", "La Casa de Papel", "Narcos", "Chernobyl", "Merlí"],
            "Personatges de ficció": ["Batman", "Spider-Man", "Sherlock Holmes", "Mickey Mouse", "Super Mario", "Darth Vader", "Elsa", "James Bond", "Pikachu", "Lara Croft"],
            "Personatges històrics": ["Leonardo da Vinci", "Cleopatra", "Albert Einstein", "Cristòfor Colom", "Marie Curie", "Napoleó", "Mozart", "Nelson Mandela", "Joana d'Arc", "Galileu"],
            "Contes populars": ["La Caputxeta Vermella", "El Gat amb Botes", "La Ventafocs", "Pinotxo", "Els Tres Porquets", "Blancaneu", "Polzet", "L'Aneguet Lleig", "La Rateta que escombrava l'escaleta", "Sant Jordi i el Drac"],
            "Marques": ["Apple", "Nike", "Coca-Cola", "Google", "Disney", "Mercedes", "Amazon", "Lego", "McDonald's", "Zara"],
            "Llocs turístics": ["Torre Eiffel", "Sagrada Família", "Muralla Xinesa", "Colosseu de Roma", "Estàtua de la Llibertat", "Machu Picchu", "Taj Mahal", "Piràmides de Gizeh", "Petra", "Alhambra"]
        };

        const baseUrl = "https://raw.githubusercontent.com/xaviUAB/impostor/main/imatges/";
        
        let workingCategories = JSON.parse(JSON.stringify(wordCategories));
        let unusedCategoryKeys = [];

        let gameConfig = {
            players: 4,
            impostors: 1,
            isRandom: false
        };

        let gameData = {
            currentPlayer: 0,
            roles: [],
            secretWord: "",
            currentCategory: "",
            actualImpostors: 0
        };

        function adjustValue(id, delta) {
            if (id === 'total-players') {
                gameConfig.players = Math.max(3, Math.min(20, gameConfig.players + delta));
                document.getElementById('display-total-players').innerText = gameConfig.players;
                
                const maxImpostors = Math.max(1, gameConfig.players - 2);
                if (gameConfig.impostors > maxImpostors) {
                    gameConfig.impostors = maxImpostors;
                    document.getElementById('display-total-impostors').innerText = gameConfig.impostors;
                }
            } else if (id === 'total-impostors') {
                const maxImpostors = Math.max(1, gameConfig.players - 2);
                gameConfig.impostors = Math.max(1, Math.min(maxImpostors, gameConfig.impostors + delta));
                document.getElementById('display-total-impostors').innerText = gameConfig.impostors;
            }
        }

        function getSecretWord() {
            let categoriesWithWords = Object.keys(workingCategories).filter(cat => workingCategories[cat].length > 0);
            
            if (categoriesWithWords.length === 0) {
                workingCategories = JSON.parse(JSON.stringify(wordCategories));
                categoriesWithWords = Object.keys(workingCategories);
                unusedCategoryKeys = [];
            }

            let validUnusedKeys = unusedCategoryKeys.filter(cat => workingCategories[cat].length > 0);

            if (validUnusedKeys.length === 0) {
                unusedCategoryKeys = [...categoriesWithWords];
                validUnusedKeys = [...unusedCategoryKeys];
            }

            const catIndex = Math.floor(Math.random() * validUnusedKeys.length);
            const chosenCategory = validUnusedKeys[catIndex];
            
            gameData.currentCategory = chosenCategory;

            const wordsList = workingCategories[chosenCategory];
            const wordIndex = Math.floor(Math.random() * wordsList.length);
            const chosenWord = wordsList[wordIndex];

            wordsList.splice(wordIndex, 1);
            unusedCategoryKeys = unusedCategoryKeys.filter(k => k !== chosenCategory);

            return chosenWord;
        }

        function startGame() {
            gameConfig.isRandom = document.getElementById('random-mode').checked;
            
            if (gameConfig.isRandom) {
                gameData.actualImpostors = Math.floor(Math.random() * gameConfig.impostors) + 1;
            } else {
                gameData.actualImpostors = gameConfig.impostors;
            }

            gameData.secretWord = getSecretWord();
            gameData.currentPlayer = 0;
            
            gameData.roles = new Array(gameConfig.players).fill(gameData.secretWord);
            
            let assignedImpostors = 0;
            while (assignedImpostors < gameData.actualImpostors) {
                let randomIndex = Math.floor(Math.random() * gameConfig.players);
                if (gameData.roles[randomIndex] !== "IMPOSTOR") {
                    gameData.roles[randomIndex] = "IMPOSTOR";
                    assignedImpostors++;
                }
            }

            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('setup-screen').classList.remove('flex');
            showTransition();
        }

        function showTransition() {
            if (gameData.currentPlayer < gameConfig.players) {
                document.getElementById('player-turn-text').innerText = `Jugador ${gameData.currentPlayer + 1}`;
                document.getElementById('transition-screen').classList.remove('hidden');
                document.getElementById('reveal-screen').classList.add('hidden');
            } else {
                showEndScreen();
            }
        }

        function revealRole() {
            const role = gameData.roles[gameData.currentPlayer];
            const display = document.getElementById('role-display');
            
            document.getElementById('transition-screen').classList.add('hidden');
            document.getElementById('reveal-screen').classList.remove('hidden');

            if (role === "IMPOSTOR") {
                const impostorImg = Math.random() > 0.5 ? "impostor.png" : "impostora.png";
                display.innerHTML = `
                    <img src="${baseUrl}${impostorImg}" class="character-img mb-6" alt="Impostor">
                    <div class="space-y-1">
                        <p class="text-slate-500 font-bold uppercase text-[8px] tracking-[0.3em]">Identitat Secreta</p>
                        <h1 class="text-4xl font-black text-white uppercase italic tracking-tighter impostor-glow">ETS L'IMPOSTOR</h1>
                    </div>
                `;
            } else {
                const civilImg = Math.random() > 0.5 ? "civil1.png" : "civil2.png";
                display.innerHTML = `
                    <img src="${baseUrl}${civilImg}" class="character-img mb-6" alt="Civil">
                    <div class="space-y-1 mb-5">
                        <p class="text-slate-500 font-bold uppercase text-[8px] tracking-[0.3em]">Paraula de la Partida</p>
                        <h1 class="text-5xl font-black text-white uppercase tracking-tight leading-tight">${role}</h1>
                    </div>
                    <div class="glass-panel px-5 py-2 rounded-full inline-block">
                        <p class="text-slate-400 font-bold uppercase text-[8px] tracking-[0.2em] italic">${gameData.currentCategory}</p>
                    </div>
                `;
            }
        }

        function nextTurn() {
            gameData.currentPlayer++;
            showTransition();
        }

        function showEndScreen() {
            document.getElementById('reveal-screen').classList.add('hidden');
            document.getElementById('transition-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('end-screen').classList.add('flex');
            
            if (gameConfig.isRandom) {
                document.getElementById('game-summary').innerText = `${gameConfig.players} Jugadors`;
                document.getElementById('game-mode-info').innerText = "Número d'impostors secret (Mode Aleatori)";
            } else {
                document.getElementById('game-summary').innerText = 
                    `${gameConfig.players} Jugadors | ${gameData.actualImpostors} Impostor${gameData.actualImpostors > 1 ? 's' : ''}`;
                document.getElementById('game-mode-info').innerText = "Mode Fix";
            }
        }

        function resetGame() {
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('flex');
            document.getElementById('setup-screen').classList.remove('hidden');
            document.getElementById('setup-screen').classList.add('flex');
        }
    </script>
</body>
</html>
